<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>CARROT</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #e0f7fa;
            font-family: Arial, sans-serif;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #title {
            margin-top: 20px;
            font-size: 48px;
            color: #d50000;
        }
        #gameContainer {
            position: relative;
            margin-top: 20px;
        }
        #gameCanvas {
            background-color: #a7ffeb;
            transition: background-color 0.5s;
            border: 2px solid #00695c;
        }
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #00695c;
            font-size: 20px;
        }
        /* Positionering af elementer uden for spilrammen */
        #leftPanel, #rightPanel {
            position: absolute;
            top: 0;
            width: 180px;
            color: #00695c;
            font-size: 20px;
        }
        #leftPanel {
            left: -200px;
            text-align: left;
        }
        #rightPanel {
            right: -200px;
            text-align: right;
        }
        #levelComplete, #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 50px;
            color: #d50000;
        }
        #playAgainBtn {
            padding: 15px 30px;
            font-size: 20px;
            background-color: #ffab00;
            color: #ffffff;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        #playAgainBtn:hover {
            background-color: #ff6f00;
        }
        #tootMessage {
            position: absolute;
            top: 45%;
            width: 100%;
            text-align: center;
            font-size: 40px;
            color: #ff6f00;
            display: none;
        }
        #powerUpTimer, #fartCooldown, #digTimer, #digCooldown {
            width: 100%;
            height: 10px;
            background-color: #ccc;
            margin-top: 5px;
            border: 1px solid #999;
        }
        #powerUpTimer div, #fartCooldown div, #digTimer div, #digCooldown div {
            height: 100%;
        }
        #powerUpTimer div {
            background-color: #76ff03;
        }
        #fartCooldown div {
            background-color: #ff6f00;
        }
        #digTimer div {
            background-color: #8d6e63;
        }
        #digCooldown div {
            background-color: #8d6e63;
        }
        #subtitle {
            margin-top: 20px;
            font-size: 18px;
            color: #00695c;
            text-align: center;
            max-width: 800px;
        }
        #controls {
            margin-top: 10px;
            font-size: 16px;
            color: #00695c;
            text-align: center;
        }
        #controls b {
            font-size: 18px;
        }
        /* Gulerodsprogressbar */
        #carrotProgressContainer {
            width: 800px;
            height: 20px;
            background-color: #ccc;
            border: 1px solid #999;
            margin-top: 10px;
            position: relative;
        }
        #carrotProgressBar {
            height: 100%;
            width: 0%;
            background-color: #76ff03;
        }
        #carrotProgressText {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            color: #00695c;
            font-size: 16px;
            line-height: 20px;
        }
        /* Nederste panel til fox count */
        #bottomPanel {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #00695c;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- Spiltitel -->
    <div id="title">CARROT</div>

    <!-- Spilcontainer -->
    <div id="gameContainer">
        <!-- Venstre panel til evner -->
        <div id="leftPanel">
            <!-- Deadly fart indikator -->
            <div id="fartIndicator">
                üí® Deadly fart
                <div id="fartCooldown">
                    <div id="fartBar"></div>
                </div>
            </div>

            <!-- Mudrunner indikator -->
            <div id="digIndicator" style="margin-top: 20px;">
                üï≥Ô∏è Mudrunner
                <div id="digCooldown" style="margin-top: 5px;">
                    <div id="digCooldownBar"></div>
                </div>
                <div id="digTimer" style="margin-top: 5px; display: none;">
                    <div id="digBar"></div>
                </div>
            </div>
        </div>

        <!-- Spilcanvas -->
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <!-- H√∏jre panel til power-ups -->
        <div id="rightPanel">
            <!-- Power-Up Indikator -->
            <div id="powerUpIndicator" style="display: none;">
                <span id="powerUpIcon">üî´</span>
                <div id="powerUpTimer">
                    <div id="timerBar"></div>
                </div>
            </div>
        </div>

        <!-- Scoreboard -->
        <div id="scoreboard">
            Level: <span id="level">1</span> |
            Score: <span id="score">0</span> |
            High Score: <span id="highScore">0</span>
        </div>

        <!-- Level Complete Besked -->
        <div id="levelComplete" style="display: none;">
            LEVEL <span id="completedLevel">1</span> COMPLETED
        </div>

        <!-- Game Over Besked -->
        <div id="gameOver" style="display: none;">
            GAME OVER<br>
            Score: <span id="finalScore">0</span><br>
            <button id="playAgainBtn">Play Again</button>
        </div>

        <!-- "TOOT!" Besked -->
        <div id="tootMessage">
            TOOT! üí®
        </div>

        <!-- Nederste panel til fox count -->
        <div id="bottomPanel">
            Foxes alive: <span id="foxesAlive">0</span> | Foxes killed: <span id="foxesKilled">0</span>
        </div>
    </div>

    <!-- Gulerodsprogressbar -->
    <div id="carrotProgressContainer">
        <div id="carrotProgressBar"></div>
        <div id="carrotProgressText">0/10 Carrots</div>
    </div>

    <!-- Undertitel/Hj√¶lpetekst -->
    <div id="subtitle">
        You must help the bunny! Eat the carrots while avoiding the foxes. Collect power-ups to defeat the foxes, and use your abilities to dodge them!
    </div>

    <!-- Controls -->
    <div id="controls">
        <b>CONTROLS</b><br>
        Shoot: MOUSE1<br>
        Deadly fart: SPACEBAR<br>
        Mudrunner: CTRL
    </div>

    <!-- JavaScript-kode -->
    <script>
        // Canvas-ops√¶tning
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Spilvariable
        let mouseX = canvas.width / 2;
        let mouseY = canvas.height / 2;
        let rabbit = { x: canvas.width / 2, y: canvas.height / 2, speed: 200 }; // pixels per sekund
        let carrots = [];
        let foxes = [];
        let bullets = [];
        let bombs = [];
        let explosions = [];
        let damageTexts = []; // Til skadetekster
        let score = 0;
        let highScore = 0;
        let level = 1;
        let carrotsCollected = 0;
        let carrotsThisLevel = 0;
        let foxesKilled = 0; // Dr√¶bte r√¶ve
        let gameRunning = true;
        let powerUp = null;
        let hasPowerUp = false;
        let powerUpTimer = 0;
        let maxPowerUpTime = 10; // 10 sekunder
        let powerUpType = null; // 'waterGun' eller 'bomb'
        let fartCooldown = 0;
        let fartActive = false;
        let fartDuration = 0;

        // Mudrunner variabler
        let isUnderground = false;
        let digTimer = 0;
        let maxDigTime = 5; // sekunder
        let digCooldown = 0;
        let maxDigCooldown = 15; // sekunders cooldown

        // Emojier
        let rabbitEmoji = 'üêá';
        const carrotEmoji = 'ü•ï';
        const foxEmoji = 'ü¶ä';
        const waterGunEmoji = 'üî´';
        const bombEmoji = 'üí£';
        const explosionEmoji = 'üí•';
        const fartEmoji = 'üí®';
        const holeEmoji = 'üï≥Ô∏è';

        // Event Listeners
        document.addEventListener('mousemove', function(event) {
            const rect = canvas.getBoundingClientRect();
            mouseX = event.clientX - rect.left;
            mouseY = event.clientY - rect.top;
        });

        document.addEventListener('mousedown', function(event) {
            if (!gameRunning || isUnderground) return;

            if (event.button === 0) { // Venstreklik
                if (hasPowerUp) {
                    if (powerUpType === 'waterGun') {
                        const rect = canvas.getBoundingClientRect();
                        const targetX = event.clientX - rect.left;
                        const targetY = event.clientY - rect.top;
                        const angle = Math.atan2(targetY - rabbit.y, targetX - rabbit.x);

                        bullets.push({
                            x: rabbit.x,
                            y: rabbit.y,
                            angle: angle,
                            speed: 400 // pixels per sekund
                        });
                    } else if (powerUpType === 'bomb') {
                        // Kaste bomben
                        const rect = canvas.getBoundingClientRect();
                        const targetX = event.clientX - rect.left;
                        const targetY = event.clientY - rect.top;
                        const angle = Math.atan2(targetY - rabbit.y, targetX - rabbit.x);

                        bombs.push({
                            x: rabbit.x,
                            y: rabbit.y,
                            angle: angle,
                            speed: 300, // pixels per sekund
                            targetX: targetX,
                            targetY: targetY,
                            exploded: false // For at sikre bomben kun eksploderer √©n gang
                        });

                        // Fjern bombe-power-up'en
                        hasPowerUp = false;
                        powerUpType = null;
                        powerUpTimer = 0;
                        document.getElementById('powerUpIndicator').style.display = 'none';
                        updateRabbitEmoji();
                    }
                }
            }
        });

        document.addEventListener('keydown', function(event) {
            if (!gameRunning) return;

            if (event.code === 'Space') {
                if (fartCooldown <= 0 && !fartActive && !isUnderground) {
                    activateFart();
                }
            }
            if (event.code === 'ControlLeft' || event.code === 'ControlRight') {
                toggleDig();
            }
        });

        function toggleDig() {
            if (isUnderground) {
                // Grav op igen
                isUnderground = false;
                canvas.style.backgroundColor = '#a7ffeb';
                digTimer = 0;
                updateDigTimer();
                updateRabbitEmoji();
                // Start cooldown
                digCooldown = maxDigCooldown;
                updateDigCooldown();
            } else {
                if (digCooldown <= 0) {
                    // Grav ned
                    isUnderground = true;
                    canvas.style.backgroundColor = '#795548'; // Brun farve
                    document.getElementById('digTimer').style.display = 'block';
                    updateRabbitEmoji();
                }
            }
        }

        function updateRabbitEmoji() {
            rabbitEmoji = 'üêá';
            if (hasPowerUp) {
                if (powerUpType === 'waterGun') {
                    rabbitEmoji += waterGunEmoji;
                } else if (powerUpType === 'bomb') {
                    rabbitEmoji += bombEmoji;
                }
            }
        }

        document.getElementById('playAgainBtn').addEventListener('click', function() {
            document.getElementById('gameOver').style.display = 'none';
            resetGame();
        });

        // Start spillet
        function initGame() {
            for (let i = 0; i < 10; i++) {
                spawnCarrot();
            }
            spawnFoxes(level + 3); // 4 r√¶ve i level 1 (1 + 3)
            updateCarrotsCollected();
            updateFoxesAlive();
            updateFoxesKilled();
            lastTime = performance.now();
            gameLoop(lastTime);
        }

        // Nulstil spillet
        function resetGame() {
            rabbit = { x: canvas.width / 2, y: canvas.height / 2, speed: 200 };
            carrots = [];
            foxes = [];
            bullets = [];
            bombs = [];
            explosions = [];
            damageTexts = [];
            score = 0;
            level = 1;
            carrotsCollected = 0;
            carrotsThisLevel = 0;
            foxesKilled = 0;
            gameRunning = true;
            hasPowerUp = false;
            powerUp = null;
            powerUpTimer = 0;
            powerUpType = null;
            fartCooldown = 0;
            fartActive = false;
            fartDuration = 0;
            isUnderground = false;
            digTimer = 0;
            digCooldown = 0;
            updateRabbitEmoji();
            document.getElementById('powerUpIndicator').style.display = 'none';
            document.getElementById('score').innerText = score;
            document.getElementById('level').innerText = level;
            document.getElementById('tootMessage').style.display = 'none';
            canvas.style.backgroundColor = '#a7ffeb';
            document.getElementById('digTimer').style.display = 'none';
            updateDigTimer();
            updateDigCooldown();
            for (let i = 0; i < 10; i++) {
                spawnCarrot();
            }
            spawnFoxes(level + 3);
            updateCarrotsCollected();
            updateFoxesAlive();
            updateFoxesKilled();
            lastTime = performance.now();
            gameLoop(lastTime);
            setTimeout(function() {
                if (gameRunning) {
                    spawnPowerUp();
                }
            }, 3000);
        }

        // Spawn en gulerod
        function spawnCarrot() {
            const carrot = {
                x: Math.random() * (canvas.width - 30) + 15,
                y: Math.random() * (canvas.height - 30) + 15
            };
            carrots.push(carrot);
        }

        // Spawn r√¶ve
        function spawnFoxes(number) {
            for (let i = 0; i < number; i++) {
                let fox = {
                    x: 0,
                    y: 0,
                    speed: 80 + Math.random() * 40, // pixels per sekund
                    normalSpeed: 80 + Math.random() * 40,
                    health: 4 // R√¶vene har 4 HP
                };
                fox.normalSpeed = fox.speed;
                // Spawn uden for canvas
                let edge = Math.floor(Math.random() * 4); // 0: venstre, 1: h√∏jre, 2: top, 3: bund
                switch (edge) {
                    case 0:
                        fox.x = -50;
                        fox.y = Math.random() * canvas.height;
                        break;
                    case 1:
                        fox.x = canvas.width + 50;
                        fox.y = Math.random() * canvas.height;
                        break;
                    case 2:
                        fox.x = Math.random() * canvas.width;
                        fox.y = -50;
                        break;
                    case 3:
                        fox.x = Math.random() * canvas.width;
                        fox.y = canvas.height + 50;
                        break;
                }
                foxes.push(fox);
            }
            updateFoxesAlive();
        }

        // Spawn power-up
        function spawnPowerUp() {
            const types = ['waterGun', 'bomb'];
            powerUpType = types[Math.floor(Math.random() * types.length)];
            powerUp = {
                x: Math.random() * (canvas.width - 30) + 15,
                y: Math.random() * (canvas.height - 30) + 15,
                type: powerUpType
            };
        }

        // Aktiver Deadly fart
        function activateFart() {
            fartActive = true;
            fartDuration = 2; // 2 sekunder
            fartCooldown = 10; // 10 sekunders cooldown
            foxes.forEach(function(fox) {
                fox.speed *= 0.5; // S√¶nk r√¶venes hastighed
            });
            canvas.style.backgroundColor = '#00ff00'; // Skift canvas baggrund til gr√∏n

            // Vis "TOOT!" besked
            const tootMessage = document.getElementById('tootMessage');
            tootMessage.style.display = 'block';
            setTimeout(function() {
                tootMessage.style.display = 'none';
            }, 1000); // Vis i 1 sekund
        }

        // Global variabel til sidste tidsstempel
        let lastTime = performance.now();

        // Spil loop
        function gameLoop(currentTime) {
            if (!gameRunning) return;

            requestAnimationFrame(gameLoop);

            // Beregn delta-tid (i sekunder)
            let deltaTime = (currentTime - lastTime) / 1000; // Konverter til sekunder
            lastTime = currentTime;

            // Begr√¶ns delta-tid for at undg√• store spring
            deltaTime = Math.min(deltaTime, 0.1); // Maks 100ms

            // Opdater fart cooldown
            if (fartCooldown > 0) {
                fartCooldown -= deltaTime;
                updateFartCooldown();
            }

            // Opdater fart varighed
            if (fartActive) {
                fartDuration -= deltaTime;
                if (fartDuration <= 0) {
                    fartActive = false;
                    foxes.forEach(function(fox) {
                        fox.speed = fox.normalSpeed; // Nulstil r√¶venes hastighed
                    });
                    canvas.style.backgroundColor = isUnderground ? '#795548' : '#a7ffeb'; // Nulstil canvas baggrund
                }
            }

            // Opdater Mudrunner timer
            if (isUnderground) {
                digTimer += deltaTime;
                updateDigTimer();
                if (digTimer >= maxDigTime) {
                    // Kaninen d√∏r
                    gameRunning = false;
                    document.getElementById('finalScore').innerText = score;
                    document.getElementById('gameOver').style.display = 'block';
                    if (score > highScore) {
                        highScore = score;
                        document.getElementById('highScore').innerText = highScore;
                    }
                    return;
                }
            } else {
                if (digCooldown > 0) {
                    digCooldown -= deltaTime;
                    updateDigCooldown();
                }
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Eksplosioner
            for (let i = explosions.length - 1; i >= 0; i--) {
                const explosion = explosions[i];
                explosion.radius += 200 * deltaTime; // Hastighed p√• eksplosionsudvidelse

                ctx.save();
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, explosion.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'rgba(255, 200, 0, 0.5)';
                ctx.fill();
                ctx.restore();

                if (explosion.radius >= explosion.maxRadius) {
                    explosions.splice(i, 1);
                }
            }

            // Flyt kaninen
            const dx = mouseX - rabbit.x;
            const dy = mouseY - rabbit.y;
            const dist = Math.hypot(dx, dy);
            if (dist > rabbit.speed * deltaTime) {
                rabbit.x += (dx / dist) * rabbit.speed * deltaTime;
                rabbit.y += (dy / dist) * rabbit.speed * deltaTime;
            }

            // Tegn kaninen
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            if (isUnderground) {
                ctx.globalAlpha = 0.5; // 50% gennemsigtighed
            }

            ctx.fillText(rabbitEmoji, rabbit.x, rabbit.y);

            if (isUnderground) {
                ctx.globalAlpha = 1.0; // Nulstil gennemsigtighed
            }

            // Tegn og tjek for gulerodssamling
            for (let i = carrots.length - 1; i >= 0; i--) {
                const carrot = carrots[i];
                ctx.fillText(carrotEmoji, carrot.x, carrot.y);
                if (!isUnderground && Math.hypot(rabbit.x - carrot.x, rabbit.y - carrot.y) < 25) {
                    carrots.splice(i, 1);
                    spawnCarrot();
                    score++;
                    carrotsCollected++;
                    carrotsThisLevel++;
                    document.getElementById('score').innerText = score;
                    updateCarrotsCollected();

                    if (carrotsThisLevel >= 10) {
                        // Level fuldf√∏rt
                        level++;
                        carrotsThisLevel = 0;
                        gameRunning = false;
                        document.getElementById('level').innerText = level;
                        document.getElementById('completedLevel').innerText = level - 1;
                        document.getElementById('levelComplete').style.display = 'block';

                        setTimeout(function() {
                            document.getElementById('levelComplete').style.display = 'none';
                            // √òg sv√¶rhedsgrad
                            spawnFoxes(level + 2); // Antallet af r√¶ve √∏ges med 1 hver gang
                            gameRunning = true;
                            lastTime = performance.now();
                            gameLoop(lastTime);
                            setTimeout(function() {
                                if (gameRunning) {
                                    spawnPowerUp();
                                }
                            }, 3000);
                        }, 3000);
                    }
                }
            }

            // Tegn og tjek for power-up
            if (powerUp) {
                const icon = powerUp.type === 'waterGun' ? waterGunEmoji : bombEmoji;
                ctx.fillText(icon, powerUp.x, powerUp.y);
                if (Math.hypot(rabbit.x - powerUp.x, rabbit.y - powerUp.y) < 25) {
                    powerUpCollected();
                }
            }

            if (!isUnderground) {
                // Opdater og tegn bullets
                for (let i = bullets.length - 1; i >= 0; i--) {
                    const bullet = bullets[i];
                    bullet.x += Math.cos(bullet.angle) * bullet.speed * deltaTime;
                    bullet.y += Math.sin(bullet.angle) * bullet.speed * deltaTime;
                    ctx.fillText('üíß', bullet.x, bullet.y);

                    // Fjern bullet hvis uden for sk√¶rmen
                    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                        bullets.splice(i, 1);
                        continue;
                    }

                    // Tjek kollision med r√¶ve
                    for (let j = foxes.length - 1; j >= 0; j--) {
                        const fox = foxes[j];
                        if (Math.hypot(bullet.x - fox.x, bullet.y - fox.y) < 20) {
                            fox.health -= 2; // Vandpistolen giver 2 skade
                            damageTexts.push({
                                x: fox.x,
                                y: fox.y - 20,
                                text: '-2',
                                opacity: 1.0,
                                lifespan: 1.0 // 1 sekund
                            });
                            bullets.splice(i, 1);
                            if (fox.health <= 0) {
                                foxes.splice(j, 1);
                                foxesKilled++;
                                score += 2;
                                document.getElementById('score').innerText = score;
                                updateFoxesKilled();
                                updateFoxesAlive();
                            }
                            break;
                        }
                    }
                }

                // Opdater og tegn bomber
                for (let i = bombs.length - 1; i >= 0; i--) {
                    const bomb = bombs[i];
                    if (!bomb.exploded) {
                        bomb.x += Math.cos(bomb.angle) * bomb.speed * deltaTime;
                        bomb.y += Math.sin(bomb.angle) * bomb.speed * deltaTime;
                        ctx.fillText(bombEmoji, bomb.x, bomb.y);

                        // Tjek om bomben n√•r m√•let
                        if (Math.hypot(bomb.x - bomb.targetX, bomb.y - bomb.targetY) < 5) {
                            // Skab eksplosion
                            explosions.push({
                                x: bomb.x,
                                y: bomb.y,
                                radius: 0,
                                maxRadius: 50
                            });
                            bomb.exploded = true;
                            // Fjern bombe-power-up'en efter eksplosion
                            hasPowerUp = false;
                            powerUpType = null;
                            powerUpTimer = 0;
                            document.getElementById('powerUpIndicator').style.display = 'none';
                            updateRabbitEmoji();
                        }
                    }
                }
            }

            // Skad r√¶ve inden for eksplosionsradius
            for (let i = explosions.length - 1; i >= 0; i--) {
                const explosion = explosions[i];
                for (let j = foxes.length - 1; j >= 0; j--) {
                    const fox = foxes[j];
                    const distance = Math.hypot(fox.x - explosion.x, fox.y - explosion.y);
                    if (distance < explosion.radius) {
                        let damage = 4; // Altid 4 skade
                        fox.health -= damage;
                        damageTexts.push({
                            x: fox.x,
                            y: fox.y - 20,
                            text: `-${damage}`,
                            opacity: 1.0,
                            lifespan: 1.0 // 1 sekund
                        });
                        if (fox.health <= 0) {
                            foxes.splice(j, 1);
                            foxesKilled++;
                            score += 2;
                            document.getElementById('score').innerText = score;
                            updateFoxesKilled();
                            updateFoxesAlive();
                        }
                    }
                }
            }

            // Flyt og tegn r√¶ve
            foxes.forEach(function(fox) {
                // Bev√¶g mod kaninen
                const fx = rabbit.x - fox.x;
                const fy = rabbit.y - fox.y;
                const fd = Math.hypot(fx, fy);
                fox.x += (fx / fd) * fox.speed * deltaTime;
                fox.y += (fy / fd) * fox.speed * deltaTime;

                ctx.fillText(foxEmoji, fox.x, fox.y);

                // Tjek kollision med kaninen
                if (!isUnderground && Math.hypot(rabbit.x - fox.x, rabbit.y - fox.y) < 25) {
                    // Game over
                    gameRunning = false;
                    document.getElementById('finalScore').innerText = score;
                    document.getElementById('gameOver').style.display = 'block';
                    if (score > highScore) {
                        highScore = score;
                        document.getElementById('highScore').innerText = highScore;
                    }
                }
            });

            // Opdater og tegn skadetekster
            for (let i = damageTexts.length - 1; i >= 0; i--) {
                const dmgText = damageTexts[i];
                dmgText.y -= 30 * deltaTime; // Bev√¶g opad
                dmgText.lifespan -= deltaTime;
                dmgText.opacity -= deltaTime;
                ctx.save();
                ctx.globalAlpha = dmgText.opacity;
                ctx.fillStyle = 'red';
                ctx.font = '20px Arial';
                ctx.fillText(dmgText.text, dmgText.x, dmgText.y);
                ctx.restore();
                if (dmgText.lifespan <= 0) {
                    damageTexts.splice(i, 1);
                }
            }

            // Power-up timer
            if (hasPowerUp) {
                powerUpTimer -= deltaTime;
                updatePowerUpTimer();
                if (powerUpTimer <= 0) {
                    hasPowerUp = false;
                    powerUpType = null;
                    powerUpTimer = 0;
                    document.getElementById('powerUpIndicator').style.display = 'none';
                    updateRabbitEmoji();
                }
            }

            // Tegn antal r√¶ve i live og dr√¶bte r√¶ve
            ctx.save();
            ctx.font = '20px Arial';
            ctx.fillStyle = '#00695c';
            ctx.textAlign = 'left';
            ctx.fillText('Foxes alive: ' + foxes.length, 10, canvas.height - 30);
            ctx.fillText('Foxes killed: ' + foxesKilled, 10, canvas.height - 10);
            ctx.restore();
        }

        function powerUpCollected() {
            // Fjern eksisterende power-up
            if (hasPowerUp) {
                hasPowerUp = false;
                powerUpTimer = 0;
                powerUpType = null;
                document.getElementById('powerUpIndicator').style.display = 'none';
            }

            // Tildel ny power-up
            if (powerUp.type === 'waterGun') {
                hasPowerUp = true;
                powerUpTimer = maxPowerUpTime; // 10 sekunder
                powerUpType = 'waterGun';
                document.getElementById('powerUpIcon').innerText = waterGunEmoji;
                document.getElementById('powerUpIndicator').style.display = 'flex';
                updatePowerUpTimer();
            } else if (powerUp.type === 'bomb') {
                hasPowerUp = true;
                powerUpTimer = maxPowerUpTime; // 10 sekunder
                powerUpType = 'bomb';
                document.getElementById('powerUpIcon').innerText = bombEmoji;
                document.getElementById('powerUpIndicator').style.display = 'flex';
                updatePowerUpTimer();
            }
            updateRabbitEmoji();
            powerUp = null;
        }

        function updatePowerUpTimer() {
            const percentage = powerUpTimer / maxPowerUpTime;
            document.getElementById('timerBar').style.width = (percentage * 100) + '%';
        }

        function updateFartCooldown() {
            const percentage = fartCooldown / 10;
            document.getElementById('fartBar').style.width = ((1 - percentage) * 100) + '%';
        }

        function updateDigTimer() {
            if (isUnderground) {
                const percentage = (maxDigTime - digTimer) / maxDigTime;
                document.getElementById('digBar').style.width = (percentage * 100) + '%';
            } else {
                document.getElementById('digBar').style.width = '100%';
                document.getElementById('digTimer').style.display = 'none';
            }
        }

        function updateDigCooldown() {
            if (digCooldown > 0) {
                const percentage = digCooldown / maxDigCooldown;
                document.getElementById('digCooldownBar').style.width = (percentage * 100) + '%';
            } else {
                document.getElementById('digCooldownBar').style.width = '100%';
            }
        }

        function updateCarrotsCollected() {
            const percentage = (carrotsThisLevel / 10) * 100;
            document.getElementById('carrotProgressBar').style.width = percentage + '%';
            document.getElementById('carrotProgressText').innerText = carrotsThisLevel + '/10 Carrots';
        }

        function updateFoxesAlive() {
            document.getElementById('foxesAlive').innerText = foxes.length;
        }

        function updateFoxesKilled() {
            document.getElementById('foxesKilled').innerText = foxesKilled;
        }

        // Start spillet
        initGame();
        setTimeout(function() {
            if (gameRunning) {
                spawnPowerUp();
            }
        }, 3000);
    </script>
</body>
</html>
